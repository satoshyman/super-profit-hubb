<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8"><title>DOGE Mining</title>
    <style>
        body { background: #000; color: #c2a633; text-align: center; font-family: sans-serif; padding-top: 50px; }
        .card { border: 2px solid #c2a633; padding: 20px; border-radius: 20px; display: inline-block; }
        .bal { font-size: 35px; color: #fff; margin: 15px; }
        .btn { background: #c2a633; color: #fff; padding: 15px 30px; border-radius: 12px; border: none; font-weight: bold; }
    </style>
</head>
<body>
    <div class="card">
        <h2>DOGECOIN MINER</h2>
        <div class="bal" id="b">0.000000</div>
        <button class="btn" onclick="setInterval(()=>{document.getElementById('b').innerText=(parseFloat(document.getElementById('b').innerText)+0.012500).toFixed(6)},1000)">Start Mining DOGE</button>
    </div>
</body>
</html>

        <div id="p-wallet" class="page-view hidden animate__animated animate__fadeIn">
            <div class="card">
                <h3 style="color:var(--primary)" id="txt-withdraw-title">INSTANT WITHDRAW</h3>
                <input type="text" id="w-email" placeholder="FaucetPay Email Address" class="v-input">
                <input type="number" id="w-amt" placeholder="Amount" class="v-input" step="0.01">
                <button class="btn-main" id="btn-withdraw">WITHDRAW TO FAUCETPAY</button>
                <div style="margin-top:10px; font-size:0.8rem; color:var(--gray);">
                    <span id="txt-min">Min:</span> <span id="min-text">1.00</span> DOGE
                </div>
                <div class="fp-box">
                    <span id="txt-no-wallet">Don't have a FaucetPay account?</span>
                    <a href="https://faucetpay.io/?r=362774" target="_blank" class="fp-link" id="txt-reg-now">Register here!</a>
                </div>
            </div>
        </div>

        <div id="p-refs" class="page-view hidden animate__animated animate__fadeIn">
            <div class="card">
                <h3 style="color:var(--primary)" id="txt-ref-title">REFERRAL PROGRAM</h3>
                <p style="font-size:0.9rem; color:var(--gray)">
                    <span id="txt-earn">Earn</span> <span id="ref-bonus-text">0.01</span> <span id="txt-earn-suffix">DOGE for every friend!</span>
                </p>
                <input type="text" id="ref-link" readonly class="v-input" style="background:#000; color:var(--primary); border-style:dashed;">
                <button class="btn-main" onclick="copyRef()" id="btn-copy">COPY LINK</button>
            </div>
            <div class="card">
                <div style="color:var(--gray)" id="txt-total-refs">TOTAL REFERRALS</div>
                <div id="ref-count-display" style="font-size:2rem; font-weight:bold; color:#fff;">0</div>
            </div>
        </div>
    </div>
    <div id="ad-bottom-slot" class="ad-slot"></div>

    <div id="smc-ui" class="smc-panel">
        <h2 style="color:var(--primary)">DOGE SMC PANEL V8.6 <span id="user-count-badge">Users: 0</span></h2>
        <label>API Key:</label><input type="text" id="cfg-api" class="v-input">
        <label>Reward:</label><input type="number" id="cfg-reward" class="v-input" step="0.0001">
        <label>Ref Bonus:</label><input type="number" id="cfg-ref-bonus" class="v-input" step="0.0001">
        <label>Wait (Min):</label><input type="number" id="cfg-wait" class="v-input">
        <label>Min Withdraw:</label><input type="number" id="cfg-min" class="v-input">
        <label>Ads Top (HTML):</label><textarea id="cfg-ad-top" class="v-input"></textarea>
        <label>Ads Bottom (HTML):</label><textarea id="cfg-ad-bottom" class="v-input"></textarea>
        <button class="btn-main" id="btn-save-smc">SAVE DOGE CONFIG</button>
        <button onclick="document.getElementById('smc-ui').style.display='none'" style="background:red; margin-top:10px;" class="btn-main">CLOSE</button>
    </div>

    <nav class="nav-bot">
        <div class="nav-item active" onclick="nav('home', this)"><i class="fas fa-bolt"></i><span id="nav-faucet">Faucet</span></div>
        <div class="nav-item" onclick="nav('wallet', this)"><i class="fas fa-wallet"></i><span id="nav-wallet">Wallet</span></div>
        <div class="nav-item" onclick="nav('refs', this)"><i class="fas fa-users"></i><span id="nav-friends">Friends</span></div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // استعادة المنطق البرمجي الكامل
        const fbCfg = { apiKey: "AIzaSyD74FRYsTCNx8RjMYBdlUKdIs46CgY5154", databaseURL: "https://pinixmining-default-rtdb.firebaseio.com" };
        const app = initializeApp(fbCfg); const db = getDatabase(app);
        const tg = window.Telegram?.WebApp;
        const tgId = tg?.initDataUnsafe?.user?.id || "user_test";
        const uid = "u_" + tgId;
        const urlParams = new URLSearchParams(window.location.search);
        const refBy = urlParams.get('start');

        let sets = { reward: 0.001, wait: 5, min: 1.0, api: "", adTop: "", adBottom: "", refBonus: 0.01 };
        let uBal = 0; let tTick; let currentLang = 'en';
        
        const userRef = ref(db, 'doge_users/' + uid);
        const configRef = ref(db, 'doge_config');

        const langData = {
            en: { totalBal: "TOTAL BALANCE (DOGE)", claimBtn: "CLAIM DOGE ⚡", withdrawTitle: "INSTANT WITHDRAW", emailPh: "FaucetPay Email Address", amtPh: "Amount", withdrawBtn: "WITHDRAW", minTxt: "Min:", refTitle: "REFERRAL PROGRAM", earnTxt: "Earn", earnSuffix: "DOGE/Friend", copyBtn: "COPY LINK", totalRefs: "TOTAL REFERRALS", navFaucet: "Faucet", navWallet: "Wallet", navFriends: "Friends", langBtn: "العربية", swalClaim: "Claimed!", swalSuccess: "Success", swalError: "Error", txtNoWallet: "No account?", txtRegNow: "Register here!" },
            ar: { totalBal: "إجمالي الرصيد (DOGE)", claimBtn: "طالب بـ DOGE ⚡", withdrawTitle: "سحب فوري", emailPh: "بريد فوست باي", amtPh: "الكمية", withdrawBtn: "سحب", minTxt: "الحد الأدنى:", refTitle: "برنامج الإحالة", earnTxt: "اربح", earnSuffix: "DOGE/صديق", copyBtn: "نسخ الرابط", totalRefs: "إجمالي الإحالات", navFaucet: "الصنبور", navWallet: "المحفظة", navFriends: "الأصدقاء", langBtn: "English", swalClaim: "تمت المطالبة!", swalSuccess: "نجاح", swalError: "خطأ", txtNoWallet: "ليس لديك حساب؟", txtRegNow: "سجل من هنا!" }
        };

        function showPop(title, text, icon, timer = null) { Swal.fire({ title, text, icon, timer, customClass: { popup: 'swal2-popup-custom' } }); }
        window.toggleLang = () => { currentLang = currentLang === 'en' ? 'ar' : 'en'; applyLang(); };
        window.onCapSolved = () => { document.getElementById('btn-claim').disabled = false; };

        function applyLang() {
            const d = langData[currentLang];
            document.getElementById('main-html').dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('lang-btn').innerText = d.langBtn;
            document.getElementById('txt-total-bal').innerText = d.totalBal;
            document.getElementById('btn-claim').innerText = d.claimBtn;
            document.getElementById('txt-withdraw-title').innerText = d.withdrawTitle;
            document.getElementById('w-email').placeholder = d.emailPh;
            document.getElementById('w-amt').placeholder = d.amtPh;
            document.getElementById('btn-withdraw').innerText = d.withdrawBtn;
            document.getElementById('txt-min').innerText = d.minTxt;
            document.getElementById('txt-ref-title').innerText = d.refTitle;
            document.getElementById('txt-earn').innerText = d.earnTxt;
            document.getElementById('txt-earn-suffix').innerText = d.earnSuffix;
            document.getElementById('btn-copy').innerText = d.copyBtn;
            document.getElementById('txt-total-refs').innerText = d.totalRefs;
            document.getElementById('nav-faucet').innerText = d.navFaucet;
            document.getElementById('nav-wallet').innerText = d.navWallet;
            document.getElementById('nav-friends').innerText = d.navFriends;
            document.getElementById('txt-no-wallet').innerText = d.txtNoWallet;
            document.getElementById('txt-reg-now').innerText = d.txtRegNow;
        }

        onValue(configRef, (s) => {
            if(s.exists()) {
                sets = s.val();
                document.getElementById('min-text').innerText = sets.min;
                document.getElementById('ref-bonus-text').innerText = sets.refBonus;
                const top = document.getElementById('ad-top-slot');
                if(sets.adTop) { top.innerHTML = sets.adTop; top.style.display = 'flex'; }
                const bot = document.getElementById('ad-bottom-slot');
                if(sets.adBottom) { bot.innerHTML = sets.adBottom; bot.style.display = 'flex'; }
            }
        });

        onValue(ref(db, 'doge_users'), (snap) => { if(snap.exists()) document.getElementById('user-count-badge').innerText = "Users: " + Object.keys(snap.val()).length; });

        get(userRef).then(async (s) => {
            if(!s.exists()) {
                let initialData = { balance: 0, last: 0, refCount: 0 };
                if(refBy && refBy !== tgId.toString()) {
                    const bossRef = ref(db, 'doge_users/u_' + refBy);
                    const bossSnap = await get(bossRef);
                    if(bossSnap.exists()) {
                        const bns = parseFloat(sets.refBonus || 0.01);
                        await update(bossRef, { balance: (bossSnap.val().balance || 0) + bns, refCount: (bossSnap.val().refCount || 0) + 1 });
                    }
                }
                await set(userRef, initialData);
            }
        });

        onValue(userRef, (s) => {
            const d = s.val() || { balance: 0, last: 0, refCount: 0 };
            uBal = d.balance || 0;
            document.getElementById('bal-display').innerText = uBal.toFixed(4);
            document.getElementById('ref-link').value = "https://t.me/BeeFaucetBot?start=" + tgId;
            document.getElementById('ref-count-display').innerText = d.refCount || 0;
            runTimer(d.last);
        });

        function runTimer(last) {
            clearInterval(tTick);
            tTick = setInterval(() => {
                const diff = (sets.wait * 60000) - (Date.now() - last);
                if(diff > 0) {
                    document.getElementById('claim-area').classList.add('hidden');
                    document.getElementById('wait-area').classList.remove('hidden');
                    const m = Math.floor(diff/60000), s = Math.floor((diff%60000)/1000);
                    document.getElementById('timer-text').innerText = `${m}:${s<10?'0'+s:s}`;
                    document.getElementById('p-bar').style.width = (((sets.wait*60000)-diff)/(sets.wait*60000)*100) + "%";
                } else { document.getElementById('claim-area').classList.remove('hidden'); document.getElementById('wait-area').classList.add('hidden'); }
            }, 1000);
        }

        document.getElementById('btn-claim').onclick = async () => {
            if(hcaptcha.getResponse() === "") return;
            await update(userRef, { balance: uBal + parseFloat(sets.reward), last: Date.now() });
            hcaptcha.reset(); document.getElementById('btn-claim').disabled = true;
            showPop(langData[currentLang].swalClaim, '', 'success', 2000);
        };

        document.getElementById('btn-withdraw').onclick = async () => {
            const email = document.getElementById('w-email').value;
            const amt = parseFloat(document.getElementById('w-amt').value);
            if(!email || isNaN(amt) || amt < sets.min || amt > uBal) return showPop('Error', 'Invalid Data', 'error');
            try {
                const res = await fetch('https://faucetpay.io/api/v1/send', { method: 'POST', body: new URLSearchParams({ api_key: sets.api, currency: 'DOGE', amount: (amt * 100000000).toFixed(0), to: email }) });
                const r = await res.json();
                if(r.status === 200) { await update(userRef, { balance: uBal - amt }); showPop('Success', 'Sent!', 'success'); } else showPop('Error', r.message, 'error');
            } catch(e) { showPop('Error', 'Connection failed', 'warning'); }
        };

        window.copyRef = () => { const el = document.getElementById("ref-link"); el.select(); document.execCommand("copy"); showPop('Copied!', '', 'success', 1000); };
        window.nav = (p, el) => { document.querySelectorAll('.page-view').forEach(v => v.classList.add('hidden')); document.getElementById('p-'+p).classList.remove('hidden'); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); el.classList.add('active'); };
        
        document.getElementById('btn-save-smc').onclick = async () => {
            await set(configRef, { api: document.getElementById('cfg-api').value, reward: document.getElementById('cfg-reward').value, refBonus: document.getElementById('cfg-ref-bonus').value, wait: document.getElementById('cfg-wait').value, min: document.getElementById('cfg-min').value, adTop: document.getElementById('cfg-ad-top').value, adBottom: document.getElementById('cfg-ad-bottom').value });
            showPop('Saved', '', 'success');
        };

        let gate = 0; document.getElementById('smc-trigger').onclick = () => { gate++; if(gate >= 5) { Swal.fire({ title: 'Admin', input: 'password', customClass: { popup: 'swal2-popup-custom' } }).then(res => { if(res.value === "Ahmednnn3") document.getElementById('smc-ui').style.display='block'; }); gate=0; } };

        applyLang();
    </script>
</body>
      </html>
                  
